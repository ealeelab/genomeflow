apiVersion: batch/v1
kind: Job
metadata:
  name: job-monocyte-144
spec:
  backoffLimit: 900
#  completions: 546 # Current 2 executed
  completions: 1
  parallelism: 1 # to g6
  template:
    metadata:
      name: job-monocyte-144
    spec:
      terminationGracePeriodSeconds: 0
      dnsPolicy: ClusterFirst
      containers:
        - name: c-job-monocyte-144
          image: gcr.io/aleelab-ten/rtea-tcga:2.2.2
          resources:
            limits:
              memory: "27.2Gi" #(27.2, 55.2)
              cpu: "7500m" #(7700, 15700m)
            requests:
              memory: "27Gi" #27, 55
              cpu: "7400m" #(7600, 15600m, 55)
          stdin: true
          tty: true
          env:
            - name: PROJECT_NAME
              value: "aleelab-ten"
            - name: TOTAL_TASK_COUNTS
              value: "144"
            - name: BROKER_URL
              value: "amqp://guest:guest@rabbitmq-service:5672"
            - name: QUEUE
              value: "1stBatch"
            - name: WORK_PATH
              value: "/app/rtea"
            - name: TEMP_PATH
              value: "/app/rtea/output"
            - name: MULTI_THREADS
              value: "8"
            - name: TARGET_FILE_EXT
              value: "fastq.gz"
            - name: REF_BUCKET
              value: "aleelab-ten-tcga-ref"
            - name: REF_PREFIX
              value: "grch38_snp_tran"
            - name: REF_PATH
              value: "/app/rtea/hg38"
            - name: OUTPUT_BUCKET
              value: "aleelab-monocyte-results"
            - name: DB_USER
              value: "aleelab"
            - name: DB_PASSWORD
              value: "aleelabAprom3!"
            - name: DB_HOST
              value: "34.73.61.94"
            - name: DB_NAME
              value: "logger_db"
            - name: GOOGLE_APPLICATION_CREDENTIALS
              value: "/app/rtea/aleelab-ten-key.json"
            - name: CREDENTIAL_FILE_NAME
              value: "/app/rtea/token.ngc"
      restartPolicy: Never
      nodeSelector:
        cloud.google.com/gke-nodepool: monocyte-add
